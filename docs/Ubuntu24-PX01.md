# Building Proxy Server

## Proxy

```
$ sudo apt update
$ sudo apt install vim iputils-ping dnsutils squid unbound
$ sudo cp /etc/squid/squid.conf /etc/squid/squid.conf.bak
$ sudo vim /etc/squid/squid.conf
$ diff /etc/squid/squid.conf /etc/squid/squid.conf.bak
1367d1366
< acl PentestingLab src 192.168.81.0/24
1569d1567
< http_access allow PentestingLab
2144c2142
< http_port 8080
---
> http_port 3128
$ sudo systemctl restart squid
```

## DNS

```
$ sudo systemctl disable systemd-resolved
$ sudo systemctl stop systemd-resolved
$ sudo cp /etc/unbound/unbound.conf /etc/unbound/unbound.conf.bak
$ sudo vim /etc/unbound/unbound.conf
$ diff /etc/unbound/unbound.conf /etc/unbound/unbound.conf.bak
10,20c10
< # include-toplevel: "/etc/unbound/unbound.conf.d/*.conf"
<
< server:
<         interface: 0.0.0.0
<
<         access-control: 127.0.0.0/8 allow
<         access-control: 192.168.81.0/24 allow
<
< forward-zone:
<         name: "."
<         forward-addr: 8.8.8.8
---
> include-toplevel: "/etc/unbound/unbound.conf.d/*.conf"
$ unbound-checkconf
$ sudo systemctl restart unbound
```

## Network Configuration

```
$ sudo mv /etc/netplan/50-cloud-init.yaml /etc/netplan/50-cloud-init.yaml.bak
$ sudo vim /etc/netplan/01-netcfg.yaml
$ sudo cat /etc/netplan/01-netcfg.yaml
network:
  ethernets:
    eth0:
      dhcp4: true
      dhcp6: false
    eth1:
      dhcp4: false
      addresses: [192.168.81.3/24]
      nameservers:
        addresses: [192.168.81.4]
      dhcp6: false
  version: 2
$ sudo chmod 600 /etc/netplan/01-netcfg.yaml
$ sudo netplan apply
```
