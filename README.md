# PentestingLab

PentestingLab is a lab environment for Active Directory intended for security assesment and penetration testing practice.
This is achieved through automated deployment using AutomatedLab.

## Installation

### 1. Install AutomatedLab

Install AutomatedLab by referring to the [official documentation](https://automatedlab.org/en/latest/Wiki/Basic/install/).

### 2. Download ISOs

Download the Microsoft Windows iso image to the LabSources folder.

- Windows Server 2022
- Windows 10
- Windows 11
- SQL Server 2019

### 3. Install PentestingLab

After installing PentestingLab, shut down the virtual machines and take snapshots.

```
PS C:\> Install-PentestingLab.ps1
PS C:\> Stop-LabVM -All
PS C:\> Checkpoint-LabVM -All -SnapshotName InitialSetup
```

## Internet Access

If you are building a lab environment with access to the Internet, you will need to manually build a proxy server using [this document](docs/Ubuntu24-PX01.md) as a reference.
After building the proxy server, install the lab with the -EnableInternet option enabled.

```
PS C:\> Install-PentestingLab.ps1 -EnableInternet
```

After installing the lab, add a network adapter to the proxy server and attach PentestingLab to the virtual switch.

## List of vulnerabilities in PentestingLab

- WIN2022-DC01
    - Kerberoast ([HackTricks](https://book.hacktricks.xyz/windows-hardening/active-directory-methodology/kerberoast))
- WIN2022-CA01
    - Misconfigured Certificate Templates - ESC1 ([HackTricks](https://book.hacktricks.xyz/windows-hardening/active-directory-methodology/ad-certificates/domain-escalation))
- WIN2022-FS01
- WIN2022-SQL01
    - Steal NetNTLM hash from MSSQL ([HackTricks1](https://book.hacktricks.xyz/windows-hardening/active-directory-methodology/abusing-ad-mssql), [HackTricks2](https://book.hacktricks.xyz/network-services-pentesting/pentesting-mssql-microsoft-sql-server))
- WIN10-WS01
    - Dumping credentials for high privilege domain account from LSASS ([HackTricks](https://book.hacktricks.xyz/windows-hardening/stealing-credentials))
- WIN11-WS02
