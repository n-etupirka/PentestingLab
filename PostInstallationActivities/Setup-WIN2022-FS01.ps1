Start-Transcript -Path C:\Windows\Temp\PostInstallation.log -append

$SecretText = "This is a secret file."

# Setup a full-access shared folder.
New-Item -Path "C:\" -Name "ShareAll" -ItemType "Directory" -Verbose
New-SmbShare -Name "ShareAll" -Path "C:\ShareAll" -FullAccess "Everyone"
icacls.exe "C:\ShareAll" /grant "Everyone:(OI)(CI)(F)"

# Setup a shared folders for administrators.
New-Item -Path "C:\" -Name "ShareAdmin" -ItemType "Directory" -Verbose
New-SmbShare -Name "ShareAdmin" -Path "C:\ShareAdmin" -FullAccess "Domain Admins"
icacls.exe "C:\ShareAdmin" /grant "Domain Admins:(OI)(CI)(F)"
icacls.exe "C:\ShareAdmin" /inheritance:d
icacls.exe "C:\ShareAdmin" /remove "Users"

# Create a secret file.
Set-Content -Path "C:\ShareAdmin\secret.txt" -Value $SecretText

Stop-Transcript
