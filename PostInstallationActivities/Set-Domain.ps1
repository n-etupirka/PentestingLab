function Set-Domain
{
    $CurrentDomain = (Get-ADDomain).DNSRoot
    $WorkFolder = "C:\$CurrentDomain"
    $Users = Import-Csv -Path "$WorkFolder\Users.csv" -Encoding UTF8
    $GPOs = Import-Csv -Path "$WorkFolder\GPOs.csv" -Encoding UTF8
    
    # Add domain users.
    foreach ($User in $Users)
    {
        $Password = $User.Password | ConvertTo-SecureString -AsPlainText -Force
        New-ADUser -Name $User.Name `
            -AccountPassword $Password `
            -PasswordNeverExpires $true `
            -Enabled $true `
            -Verbose
    
        if ($User.isAdmin -eq "True")
        {
            Add-ADGroupMember -Identity "Domain Admins" -Members $User.Name
        }
    }
    
    # Apply GPOs.
    foreach ($GPO in $GPOs)
    {
        # Backup-GPO -Name $GPOName -Path "C:\Windows\Temp" -Comment $GPOName
        Import-GPO -CreateIfNeeded -BackupGpoName $GPO.Name -TargetName $GPO.Name -Path "$WorkFolder\GPOs"
        New-GPLink -Name $GPO.Name -Target "DC=ad,DC=example,DC=local"
    }
    
    # Register SPN for Kerberoasting.
    setspn.exe -S "HTTP/WIN2022-WEB01.ad.example.local" "ad\iis_admin"
    
    # New-ADOrganizationalUnit -Name 'Workstation' -Path "DC=ad,DC=example,DC=local" -Verbose
    # Move-ADObject -Identity "CN=WIN11-WS01,CN=Computers,DC=ad,DC=example,DC=local" -TargetPath "OU=Workstation,DC=ad,DC=example,DC=local" -Verbose
}
