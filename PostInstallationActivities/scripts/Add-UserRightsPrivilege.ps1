
function Add-UserRightsPrivilege
{
    Param(
        [Parameter(Mandatory)]
        [String]
        $SID,

        [Parameter(Mandatory)]
        [String]
        $Right
    )

    $SecPolFile = New-TemporaryFile

    SecEdit.exe /export /cfg $SecPolFile | Out-Null

    $SecPol = (Get-Content $SecPolFile)
    $RightMatch = ($SecPol | Select-String -Pattern "^$Right = \*S-")

    if ($null -eq $RightMatch)
    {
        Write-Error "Right: $Right is not exist."
        Remove-Item -Path $SecPolFile
        return 1
    }

    $RightLine = $RightMatch.Line

    if ($RightLine.Contains("*$SID"))
    {
        Write-Error "Right: $Right contains '$SID'."
        Remove-Item -Path $SecPolFile
        return 1
    }

    $SIDStr = ",*$SID"
    $FixedLine = $RightLine + $SIDStr
    $FixedSecPol = $SecPol.Replace($RightLine, $FixedLine)

    $FixedSecPol | Out-File $SecPolFile | Out-Null

    SecEdit.exe /configure /db C:\Windows\security\local.sdb /cfg $SecPolFile /areas USER_RIGHTS | Out-Null

    Remove-Item -Path $SecPolFile

    return
}
